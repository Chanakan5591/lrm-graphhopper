(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){function corslite(url,callback,cors){var sent=false;if(typeof window.XMLHttpRequest==="undefined"){return callback(Error("Browser not supported"))}if(typeof cors==="undefined"){var m=url.match(/^\s*https?:\/\/[^\/]*/);cors=m&&m[0]!==location.protocol+"//"+location.domain+(location.port?":"+location.port:"")}var x=new window.XMLHttpRequest;function isSuccessful(status){return status>=200&&status<300||status===304}if(cors&&!("withCredentials"in x)){x=new window.XDomainRequest;var original=callback;callback=function(){if(sent){original.apply(this,arguments)}else{var that=this,args=arguments;setTimeout(function(){original.apply(that,args)},0)}}}function loaded(){if(x.status===undefined||isSuccessful(x.status))callback.call(x,null,x);else callback.call(x,x,null)}if("onload"in x){x.onload=loaded}else{x.onreadystatechange=function readystate(){if(x.readyState===4){loaded()}}}x.onerror=function error(evt){callback.call(this,evt||true,null);callback=function(){}};x.onprogress=function(){};x.ontimeout=function(evt){callback.call(this,evt,null);callback=function(){}};x.onabort=function(evt){callback.call(this,evt,null);callback=function(){}};x.open("GET",url,true);x.send(null);sent=true;return x}if(typeof module!=="undefined")module.exports=corslite},{}],2:[function(require,module,exports){var polyline={};function encode(coordinate,factor){coordinate=Math.round(coordinate*factor);coordinate<<=1;if(coordinate<0){coordinate=~coordinate}var output="";while(coordinate>=32){output+=String.fromCharCode((32|coordinate&31)+63);coordinate>>=5}output+=String.fromCharCode(coordinate+63);return output}polyline.decode=function(str,precision){var index=0,lat=0,lng=0,coordinates=[],shift=0,result=0,byte=null,latitude_change,longitude_change,factor=Math.pow(10,precision||5);while(index<str.length){byte=null;shift=0;result=0;do{byte=str.charCodeAt(index++)-63;result|=(byte&31)<<shift;shift+=5}while(byte>=32);latitude_change=result&1?~(result>>1):result>>1;shift=result=0;do{byte=str.charCodeAt(index++)-63;result|=(byte&31)<<shift;shift+=5}while(byte>=32);longitude_change=result&1?~(result>>1):result>>1;lat+=latitude_change;lng+=longitude_change;coordinates.push([lat/factor,lng/factor])}return coordinates};polyline.encode=function(coordinates,precision){if(!coordinates.length)return"";var factor=Math.pow(10,precision||5),output=encode(coordinates[0][0],factor)+encode(coordinates[0][1],factor);for(var i=1;i<coordinates.length;i++){var a=coordinates[i],b=coordinates[i-1];output+=encode(a[0]-b[0],factor);output+=encode(a[1]-b[1],factor)}return output};if(typeof module!==undefined)module.exports=polyline},{}],3:[function(require,module,exports){(function(global){(function(){"use strict";var L=typeof window!=="undefined"?window["L"]:typeof global!=="undefined"?global["L"]:null;var corslite=require("corslite");var polyline=require("polyline");L.Routing=L.Routing||{};L.Routing.GraphHopper=L.Evented.extend({options:{serviceUrl:"https://graphhopper.com/api/1/route",timeout:30*1e3,urlParameters:{},profile:"car",useCustomModel:false,customModel:{distance_influence:15,priority:[{if:"road_surface == PAVED",multiply_by:"1.4"},{if:"road_environment == FERRY",multiply_by:"0.9"}],speed:[],areas:{type:"FeatureCollection",features:[]}}},initialize:function(apiKey,options){this._apiKey=apiKey;L.Util.setOptions(this,options)},route:function(waypoints,callback,context,options){var timedOut=false;var waypointsCopy=[];var url,timer;var self=this;context=context||callback;options=options||{};for(var i=0;i<waypoints.length;i++){waypointsCopy.push({latLng:waypoints[i].latLng,name:waypoints[i].name,options:waypoints[i].options})}url=this._buildRouteUrl(waypointsCopy,options);timer=setTimeout(function(){timedOut=true;callback.call(context,{status:-1,message:"GraphHopper request timed out."})},this.options.timeout);if(this.options.useCustomModel){this._makePostRequest(url,waypointsCopy,callback,context,timer,timedOut)}else{this._makeGetRequest(url,waypointsCopy,callback,context,timer,timedOut)}return this},_makePostRequest:function(url,waypoints,callback,context,timer,timedOut){var xhr=new XMLHttpRequest;var self=this;xhr.open("POST",url,true);xhr.setRequestHeader("Content-Type","application/json");xhr.onreadystatechange=function(){if(xhr.readyState===4){clearTimeout(timer);if(!timedOut){self.fire("response",{status:xhr.status});if(xhr.status>=200&&xhr.status<300){try{var data=JSON.parse(xhr.responseText);self._processRouteResponse(data,waypoints,callback,context)}catch(e){callback.call(context,{status:-1,message:"Failed to parse GraphHopper response: "+e.message})}}else{self._handleRequestError(xhr.responseText,xhr.statusText,callback,context)}}}};xhr.send(JSON.stringify(this.options.customModel))},_makeGetRequest:function(url,waypoints,callback,context,timer,timedOut){var self=this;corslite(url,function(err,resp){clearTimeout(timer);if(!timedOut){self.fire("response",{status:err?err.status:resp.status});if(!err){try{var data=JSON.parse(resp.responseText);self._processRouteResponse(data,waypoints,callback,context)}catch(e){callback.call(context,{status:-1,message:"Failed to parse GraphHopper response: "+e.message})}}else{self._handleRequestError(err.responseText,err,callback,context)}}})},_handleRequestError:function(responseText,err,callback,context){var finalResponse;try{finalResponse=JSON.parse(responseText)}catch(e){finalResponse=responseText}callback.call(context,{status:-1,message:"HTTP request failed: "+err,response:finalResponse})},_processRouteResponse:function(response,inputWaypoints,callback,context){if(this._hasApiErrors(response)){var error=response.info.errors[0];callback.call(context,{status:error.details,message:error.message});return}var routes=this._convertRoutes(response.paths,inputWaypoints);callback.call(context,null,routes)},_hasApiErrors:function(response){return response.info&&response.info.errors&&response.info.errors.length},_convertRoutes:function(paths,inputWaypoints){var routes=[];for(var i=0;i<paths.length;i++){var path=paths[i];var coordinates=this._decodePolyline(path.points);var description=path.description&&path.description.join(", ");var waypoints=inputWaypoints.slice();if(path.points_order){var reorderedWaypoints=[];for(var j=0;j<path.points_order.length;j++){reorderedWaypoints.push(inputWaypoints[path.points_order[j]])}waypoints=reorderedWaypoints}var mappedWaypoints=this._mapWaypointIndices(waypoints,path.instructions,coordinates);routes.push({name:description||"Route",coordinates:coordinates,instructions:this._convertInstructions(path.instructions),summary:{totalDistance:path.distance,totalTime:path.time/1e3,totalAscend:path.ascend||0},inputWaypoints:waypoints,actualWaypoints:mappedWaypoints.waypoints,waypointIndices:mappedWaypoints.waypointIndices})}return routes},_decodePolyline:function(encodedPolyline){var coords=polyline.decode(encodedPolyline,5);var latlngs=[];for(var i=0;i<coords.length;i++){latlngs.push(new L.LatLng(coords[i][0],coords[i][1]))}return latlngs},_buildRouteUrl:function(waypoints,options){var pointParams=[];for(var i=0;i<waypoints.length;i++){pointParams.push("point="+waypoints[i].latLng.lat+","+waypoints[i].latLng.lng)}var baseUrl=this.options.serviceUrl+"?"+pointParams.join("&");var urlParams={instructions:true,type:"json",profile:this.options.profile,key:this._apiKey};for(var key in this.options.urlParameters){if(this.options.urlParameters.hasOwnProperty(key)){urlParams[key]=this.options.urlParameters[key]}}if(this.options.useCustomModel){urlParams.custom_model=true;urlParams.ch=false}if(options.alternatives){urlParams.alternative_route={max_paths:options.alternatives}}if(options.avoid){urlParams.avoid=options.avoid}return baseUrl+L.Util.getParamString(urlParams,baseUrl)},_convertInstructions:function(instructions){if(!instructions||!instructions.length){return[]}var signToType={"-7":"SlightLeft","-3":"SharpLeft","-2":"Left","-1":"SlightLeft",0:"Straight",1:"SlightRight",2:"Right",3:"SharpRight",4:"DestinationReached",5:"WaypointReached",6:"Roundabout",7:"SlightRight"};var result=[];for(var i=0;i<instructions.length;i++){var instr=instructions[i];var type=i===0?"Head":signToType[instr.sign.toString()];result.push({type:type,modifier:type,text:instr.text,distance:instr.distance,time:instr.time/1e3,index:instr.interval[0],exit:instr.exit_number})}return result},_mapWaypointIndices:function(waypoints,instructions,coordinates){var resultWaypoints=[];var waypointIndices=[];waypointIndices.push(0);resultWaypoints.push(new L.Routing.Waypoint(coordinates[0],waypoints[0].name));if(instructions){for(var i=0;i<instructions.length;i++){if(instructions[i].sign===5){var idx=instructions[i].interval[0];waypointIndices.push(idx);resultWaypoints.push({latLng:coordinates[idx],name:waypoints[resultWaypoints.length].name})}}}waypointIndices.push(coordinates.length-1);resultWaypoints.push({latLng:coordinates[coordinates.length-1],name:waypoints[waypoints.length-1].name});return{waypointIndices:waypointIndices,waypoints:resultWaypoints}}});L.Routing.graphHopper=function(apiKey,options){return new L.Routing.GraphHopper(apiKey,options)};module.exports=L.Routing.GraphHopper})()}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{corslite:1,polyline:2}]},{},[3]);
